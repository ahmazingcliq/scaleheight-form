<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScaleHeight Registration</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Styles for aesthetics and responsiveness */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }
        .app-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .card {
            background-color: white;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            border-radius: 1rem;
            width: 100%;
            max-width: 450px;
            margin: 1rem;
            padding: 2rem;
        }
        .input-group label {
            font-weight: 500;
            color: #4a5568;
            margin-bottom: 0.25rem;
            display: block;
        }
        /* Custom scrollbar for better look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-thumb { background-color: #9ca3af; border-radius: 10px; }
        ::-webkit-scrollbar-track { background-color: #f3f4f6; }

        /* Full-screen Receipt Modal Styling */
        .receipt-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            z-index: 50;
            overflow-y: auto;
            transition: opacity 0.3s ease-in-out;
        }
    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'scale-green': '#10b981', /* Emerald 500 */
                        'scale-red': '#ef4444',   /* Red 500 */
                        'scale-blue': '#3b82f6', /* Blue 500 */
                    },
                }
            }
        }
    </script>
</head>
<body class="bg-gray-100">

    <div id="app-container" class="app-container">

        <!-- ===== PAGE 1: ACCOUNT CREATION ===== -->
        <div id="page-signup" class="card">
            <!-- HEADER COLOR CHANGED TO text-scale-blue -->
            <h2 class="text-3xl font-extrabold text-scale-blue mb-6 text-center">Create An Account</h2>
            <form id="signup-form">
                <div class="space-y-4">
                    <!-- First Name -->
                    <div class="input-group">
                        <label for="firstName">Enter First Name</label>
                        <input type="text" id="firstName" placeholder="First Name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
                    </div>
                    <!-- Last Name -->
                    <div class="input-group">
                        <label for="lastName">Enter Last Name</label>
                        <input type="text" id="lastName" placeholder="Last Name" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
                    </div>
                    <!-- Phone Number -->
                    <div class="input-group">
                        <label for="phone">Enter Phone Number</label>
                        <input type="tel" id="phone" placeholder="Phone Number" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
                    </div>
                    <!-- Email Address -->
                    <div class="input-group">
                        <label for="email">Enter Email Address</label>
                        <input type="email" id="email" placeholder="Email Address" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
                    </div>
                    <!-- Password -->
                    <div class="input-group">
                        <label for="password">Enter Password</label>
                        <div class="relative">
                            <input type="password" id="password" placeholder="Password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
                            <button type="button" onclick="togglePassword('password')" class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5 text-gray-500">
                                <span id="password-toggle-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <!-- Confirm Password -->
                    <div class="input-group">
                        <label for="confirmPassword">Enter Password again</label>
                        <div class="relative">
                            <input type="password" id="confirmPassword" placeholder="Enter Password again" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
                            <button type="button" onclick="togglePassword('confirmPassword')" class="absolute inset-y-0 right-0 pr-3 flex items-center text-sm leading-5 text-gray-500">
                                <span id="confirmPassword-toggle-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Error Message -->
                <p id="signup-error" class="text-scale-red text-sm mt-3 hidden"></p>

                <!-- Actions -->
                <button type="submit" class="w-full bg-scale-blue text-white py-3 mt-6 rounded-lg font-semibold hover:bg-blue-700 transition duration-150">Continue</button>
            </form>

            <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-100">
                <button onclick="showPage('page-login')" class="text-sm text-scale-blue hover:text-blue-700 font-medium">Login</button>
                <button onclick="showPage('page-forgot-password')" class="text-sm text-gray-500 hover:text-scale-blue">Forgot Password?</button>
            </div>
        </div>

        <!-- ===== PAGE 2: EMAIL VERIFICATION ===== -->
        <div id="page-email-verification" class="card hidden text-center">
            <!-- HEADER COLOR CHANGED TO text-scale-blue -->
            <h2 class="text-3xl font-extrabold text-scale-blue mb-4">EMAIL VERIFICATION</h2>
            <p class="text-gray-600 mb-8">
                A verification link has been sent to your email address. Please check your inbox (and spam folder) to complete your registration.
            </p>

            <div class="space-y-4 mb-8">
                 <!-- Contact Support Block -->
                <p class="text-gray-500 text-sm">
                    If You Need more Explanation on Scaleheight, or You have Any Issue with Making Payment, <a href="https://wa.link/m2g76j" target="_blank" class="text-scale-blue hover:underline font-semibold">Click here to Contact our Support Team.</a>
                </p>
                <!-- Separator -->
                <hr class="border-gray-200">
            </div>

            <div class="flex justify-between space-x-4">
                <button onclick="showPage('page-signup')" class="w-1/2 py-3 border border-gray-300 text-gray-700 rounded-lg font-semibold hover:bg-gray-50 transition duration-150">Previous</button>
                <button onclick="showPage('page-coupon-entry')" class="w-1/2 bg-scale-blue text-white py-3 rounded-lg font-semibold hover:bg-blue-700 transition duration-150">Submit</button>
            </div>
        </div>

        <!-- ===== PAGE 3: COUPON/PACKAGE SELECTION (Welcome) ===== -->
        <div id="page-coupon-entry" class="card hidden text-center">
            <!-- HEADER COLOR CHANGED TO text-scale-blue -->
            <h2 class="text-3xl font-extrabold text-scale-blue mb-4">WELCOME TO SCALE HEIGHT</h2>
            <p class="text-gray-600 mb-6">
                You need a coupon code to register on Scaleheight.
            </p>

            <div class="input-group mb-4">
                <input type="text" id="couponCode" placeholder="Enter Coupon Code" class="w-full px-4 py-3 border-2 border-dashed border-scale-blue rounded-lg text-center font-bold text-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
            </div>
            
            <!-- Coupon Validation Error Message -->
            <p id="coupon-error" class="text-scale-red text-sm mt-1 mb-4 hidden">Invalid coupon code. Please check and try again.</p>

            <!-- Submit Button (New Feature) -->
            <button onclick="validateCouponAndRedirect()" class="w-full bg-scale-green text-white py-3 rounded-lg font-semibold hover:bg-emerald-600 transition duration-150">Submit Coupon Code</button>

            <!-- Existing Gemini Feature: Package Pitch Generator -->
            <button id="generate-pitch-btn" onclick="generateAndDisplayPitch()" class="w-full text-sm bg-gray-200 text-gray-800 py-2 rounded-lg font-medium hover:bg-gray-300 transition duration-150 flex items-center justify-center space-x-2 mt-4">
                <span>Why Standard Package? ‚ú® Generate Value Pitch</span>
            </button>
            <div id="package-pitch" class="mb-6">
                <!-- LLM generated text goes here -->
            </div>
            <!-- End Gemini Feature -->

            <p class="text-gray-600 mb-4">
                To Get Coupon Code, Select one of the Registration Packages Below:
            </p>

            <!-- Package Selection (Button to trigger Receipt Modal) -->
            <button onclick="toggleReceiptModal(true)" class="w-full border-2 border-scale-green bg-scale-green/10 p-5 rounded-xl text-left hover:shadow-lg transition duration-300 mb-6">
                <div class="flex justify-between items-center">
                    <div>
                        <p class="text-xl font-bold text-scale-green">Standard Package</p>
                    </div>
                    <div class="text-right">
                        <p class="text-3xl font-extrabold text-scale-green">‚Ç¶12,000</p>
                        <p class="text-sm text-gray-500 line-through">‚Ç¶16,000</p>
                    </div>
                </div>
                <p class="text-scale-green/80 text-sm mt-2">Click to proceed to payment and get your coupon code.</p>
            </button>

            <!-- Back Link/Support -->
            <a href="https://wa.link/m2g76j" target="_blank" class="text-sm text-gray-500 hover:text-scale-blue font-medium underline">
                Need more explanation? Contact Support.
            </a>
        </div>

        <!-- ===== PAGE 5: LOGIN PAGE (Simplified) ===== -->
        <div id="page-login" class="card hidden">
            <!-- HEADER COLOR CHANGED TO text-scale-blue -->
            <h2 class="text-3xl font-extrabold text-scale-blue mb-6 text-center">Login to Account</h2>
            <form>
                <div class="space-y-4">
                    <div class="input-group">
                        <label for="loginEmail">Email Address</label>
                        <input type="email" id="loginEmail" placeholder="Email Address" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
                    </div>
                    <div class="input-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" id="loginPassword" placeholder="Password" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
                    </div>
                </div>
                <button type="submit" class="w-full bg-scale-blue text-white py-3 mt-6 rounded-lg font-semibold hover:bg-blue-700 transition duration-150">Login</button>
            </form>
            <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-100">
                <button onclick="showPage('page-signup')" class="text-sm text-gray-500 hover:text-scale-blue">Create Account</button>
                <button onclick="showPage('page-forgot-password')" class="text-sm text-gray-500 hover:text-scale-blue">Forgot Password?</button>
            </div>
        </div>

        <!-- ===== PAGE 5/Alternate: FORGOT PASSWORD PAGE (Simplified) ===== -->
        <div id="page-forgot-password" class="card hidden">
            <!-- HEADER COLOR CHANGED TO text-scale-blue -->
            <h2 class="text-3xl font-extrabold text-scale-blue mb-6 text-center">Forgot Password</h2>
            <p class="text-gray-600 mb-6 text-center">Enter your email address to receive a password reset link.</p>
            <form>
                <div class="input-group">
                    <label for="resetEmail">Email Address</label>
                    <input type="email" id="resetEmail" placeholder="Email Address" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-scale-blue">
                </div>
                <button type="submit" class="w-full bg-scale-blue text-white py-3 mt-6 rounded-lg font-semibold hover:bg-blue-700 transition duration-150">Reset Password</button>
            </form>
            <button onclick="showPage('page-login')" class="w-full text-center text-sm text-gray-500 hover:text-scale-blue mt-4">Back to Login</button>
        </div>

    </div>

    <!-- ===== FULL-SCREEN PAYMENT GATEWAY/RECEIPT MODAL (Page 4 Logic) ===== -->
    <div id="receipt-modal" class="receipt-modal hidden opacity-0 flex flex-col items-center justify-start p-6">
        <div class="w-full max-w-lg mx-auto">
            <div class="flex justify-center items-center py-4 mb-4 border-b border-gray-200">
                <!-- HEADER COLOR CHANGED TO text-scale-blue -->
                <h2 class="text-2xl font-bold text-scale-blue">SCALEHEIGHT Payment Gateway</h2>
            </div>

            <!-- Warning/Note Section -->
            <div class="p-4 mb-6 bg-red-100 border-l-4 border-scale-red rounded-lg shadow-md">
                <p class="text-sm text-scale-red font-bold">
                    <span class="inline-block px-1 bg-scale-red text-white rounded mr-1">NOTE:</span>
                    DO NOT PAY WITH OPAY. IT IS NOT ACCEPTED ON SCALEHEIGHT, USE ANY OTHER BANK OR POS TO PAY.
                </p>
            </div>

            <p class="text-sm text-gray-700 mb-4">
                Please make your payment to the account below.
            </p>
            <p class="text-xs text-gray-500 mb-6">
                After making payment, please contact support with your payment receipt.
            </p>

            <!-- Amount to Pay -->
            <div class="text-center mb-6 py-4 border-b border-t border-gray-200">
                <p class="text-gray-500 text-xs mb-1">Amount to Pay</p>
                <div class="flex justify-center items-center space-x-2">
                    <p class="text-4xl font-extrabold text-gray-900">‚Ç¶12,000</p>
                    <button onclick="copyToClipboard('12000')" class="text-sm text-scale-blue font-semibold flex items-center hover:text-blue-700 transition duration-150">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v10a2 2 0 002 2h2m0-10h8a2 2 0 012 2v2M8 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2h-2"></path></svg>
                        Copy
                    </button>
                </div>
            </div>

            <!-- Account Details -->
            <div class="space-y-4 mb-8">
                <!-- Account Number -->
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div class="flex flex-col">
                        <span class="text-xs text-gray-500">Account Number</span>
                        <span class="text-xl font-bold text-gray-900">9859505879</span>
                    </div>
                    <button onclick="copyToClipboard('9859505879')" class="text-scale-blue hover:text-blue-700 transition duration-150">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v10a2 2 0 002 2h2m0-10h8a2 2 0 012 2v2M8 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2h-2"></path></svg>
                    </button>
                </div>

                <!-- Bank Name -->
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div class="flex flex-col">
                        <span class="text-xs text-gray-500">Bank Name</span>
                        <span class="text-xl font-bold text-gray-900">Paystack Titan</span>
                    </div>
                    <button onclick="copyToClipboard('Paystack Titan')" class="text-scale-blue hover:text-blue-700 transition duration-150">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v10a2 2 0 002 2h2m0-10h8a2 2 0 012 2v2M8 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2h-2"></path></svg>
                    </button>
                </div>

                <!-- Account Name -->
                <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                    <div class="flex flex-col">
                        <span class="text-xs text-gray-500">Account Name</span>
                        <span class="text-xl font-bold text-gray-900">Tirimisiyu Usman</span>
                    </div>
                    <button onclick="copyToClipboard('Tirimisiyu Usman')" class="text-scale-blue hover:text-blue-700 transition duration-150">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v10a2 2 0 002 2h2m0-10h8a2 2 0 012 2v2M8 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2h-2"></path></svg>
                    </button>
                </div>
            </div>

            <!-- Actions -->
            <button onclick="contactSupport()" class="w-full bg-scale-green text-white py-4 rounded-lg font-extrabold text-lg shadow-xl hover:bg-emerald-600 transition duration-150 mb-3">
                I have made this transfer
            </button>
            <p class="text-center text-sm">
                <a href="https://wa.link/m2g76j" target="_blank" class="font-bold underline text-scale-blue hover:text-blue-700">Need help? Contact Scale height Support</a>
            </p>

             <button onclick="toggleReceiptModal(false)" class="w-full text-center text-sm text-gray-500 hover:text-gray-900 mt-4 py-2 border-t border-gray-100">
                Back to Registration
            </button>
        </div>
    </div>


    <!-- ===== JAVASCRIPT LOGIC (Must be at the end of body) ===== -->
    <script type="module">
        // ====================================================================
        // FIREBASE SETUP (Mandatory Boilerplate for Canvas environment)
        // ====================================================================
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let db, auth;

        async function initializeFirebase() {
            try {
                if (Object.keys(firebaseConfig).length === 0) {
                    console.error("Firebase config is missing. Cannot initialize Firestore/Auth.");
                    return;
                }

                setLogLevel('debug');
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);

                // Authenticate using custom token or anonymously
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                    console.log("Firebase signed in with custom token.");
                } else {
                    await signInAnonymously(auth);
                    console.log("Firebase signed in anonymously.");
                }

            } catch (error) {
                console.error("Firebase Initialization Error:", error);
            }
        }

        initializeFirebase();

        // ====================================================================
        // CONSTANTS (NEW)
        // ====================================================================
        const VALID_COUPON_CODE = "SCALE2025"; // Mock valid coupon code for validation
        const DASHBOARD_URL = "https://sites.google.com/view/scaleheight/dashboard";


        // ====================================================================
        // GEMINI API INTEGRATION
        // ====================================================================
        const API_URL = "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=";
        const API_KEY = ""; // Managed by canvas environment

        // System prompt to define the model's persona and output style
        const packageSystemPrompt = `You are a highly persuasive, concise marketing copywriter for a growth platform called ScaleHeight. Your goal is to write a single, short, and highly motivating paragraph (max 3 sentences) that justifies the immediate purchase of the 'Standard Package' priced at ‚Ç¶12,000 (discounted from ‚Ç¶16,000). Focus on immediate value, return on investment (ROI), and the urgency of the discount. Do not use any markdown formatting (like bolding, lists, or headers).`;

        /**
         * Calls the Gemini API to generate persuasive marketing copy (Value Pitch).
         * Implements exponential backoff for rate limiting.
         * @returns {Promise<string>} The generated text or a fallback message.
         */
        async function generateMarketingPitch() {
            const userQuery = "Generate the compelling pitch for the ScaleHeight Standard Package (‚Ç¶12,000, save ‚Ç¶4,000).";
            const maxRetries = 5;
            let delay = 1000;

            const payload = {
                contents: [{ parts: [{ text: userQuery }] }],
                systemInstruction: { parts: [{ text: packageSystemPrompt }] },
            };

            const apiUrl = `${API_URL}${API_KEY}`;

            for (let i = 0; i < maxRetries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        if (response.status === 429 && i < maxRetries - 1) {
                            console.warn(`Rate limit hit. Retrying in ${delay / 1000}s...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            delay *= 2; // Exponential backoff
                            continue;
                        } else {
                            throw new Error(`API call failed with status: ${response.status}`);
                        }
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text || "Failed to generate pitch.";
                    return text;

                } catch (error) {
                    console.error("Gemini API Error:", error);
                    // Fallback message after all retries fail
                    return "Unlock instant access and maximize your savings today! The discounted Standard Package offers immediate value, securing your path to success on ScaleHeight for a fraction of the original cost.";
                }
            }
            // Final fallback after exhausting all retries
            return "Unlock instant access and maximize your savings today! The discounted Standard Package offers immediate value, securing your path to success on ScaleHeight for a fraction of the original cost.";
        }

        /**
         * Handler for the pitch generation button.
         */
        window.generateAndDisplayPitch = async () => {
            const pitchContainer = document.getElementById('package-pitch');
            const pitchButton = document.getElementById('generate-pitch-btn');

            pitchContainer.innerHTML = '<span class="text-scale-blue">Generating personalized pitch...</span>';
            pitchButton.disabled = true;
            pitchButton.classList.add('opacity-50', 'cursor-not-allowed');

            const pitch = await generateMarketingPitch();
            pitchContainer.innerHTML = `<p class="italic text-gray-700 mt-2 p-3 bg-blue-50 border border-scale-blue rounded-lg">${pitch}</p>`;

            pitchButton.disabled = false;
            pitchButton.classList.remove('opacity-50', 'cursor-not-allowed');
        }

        // ====================================================================
        // COUPON VALIDATION AND REDIRECT FUNCTION
        // ====================================================================
        /**
         * Validates the entered coupon code and redirects to the dashboard on success.
         */
        window.validateCouponAndRedirect = () => {
            const couponInput = document.getElementById('couponCode');
            const couponError = document.getElementById('coupon-error');
            // Normalize input to uppercase and trim spaces for validation
            const enteredCode = couponInput.value.trim().toUpperCase();

            couponError.classList.add('hidden'); // Reset error message

            if (enteredCode === VALID_COUPON_CODE) {
                // Success: Redirect to the dashboard
                console.log("Coupon validated. Redirecting to dashboard...");
                window.location.href = DASHBOARD_URL;
            } else {
                // Failure: Show error message
                couponError.textContent = "Invalid coupon code. Please check and try again.";
                couponError.classList.remove('hidden');
                console.warn("Invalid coupon code entered:", enteredCode);
            }
        }
        
        // ====================================================================
        // APPLICATION LOGIC
        // ====================================================================
        const pages = ['page-signup', 'page-email-verification', 'page-coupon-entry', 'page-login', 'page-forgot-password'];
        const receiptModal = document.getElementById('receipt-modal');
        const signupForm = document.getElementById('signup-form');
        const signupError = document.getElementById('signup-error');

        /**
         * Simulates client-side routing to show one page and hide others.
         * @param {string} pageId - The ID of the page to show.
         */
        window.showPage = (pageId) => {
            pages.forEach(id => {
                const page = document.getElementById(id);
                if (page) {
                    page.classList.add('hidden');
                }
            });
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }
        }

        /**
         * Toggles the visibility of a password field and its icon.
         * @param {string} inputId - The ID of the password input field.
         */
        window.togglePassword = (inputId) => {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(`${inputId}-toggle-icon`);
            if (input.type === 'password') {
                input.type = 'text';
                icon.textContent = 'üôà'; // Hide Icon
            } else {
                input.type = 'password';
                icon.textContent = 'üëÅÔ∏è'; // Show Icon
            }
        }

        /**
         * Mocks the secure API call for validation/coupon generation.
         */
        const mockApiCall = async (data) => {
            return new Promise(resolve => {
                setTimeout(() => {
                    // Simple validation logic
                    if (data.password !== data.confirmPassword) {
                        resolve({ success: false, message: "Passwords do not match." });
                    } else if (!data.email || !data.password || !data.firstName) {
                         resolve({ success: false, message: "Please fill in all required fields." });
                    } else if (data.email.includes('testfail')) {
                        // Example of a mock failure
                        resolve({ success: false, message: "This email is already registered." });
                    } else {
                        // Mock Success: Email valid, user created, proceeding to verification
                        resolve({ success: true, message: "Account created successfully. Proceeding to email verification." });
                    }
                }, 1000); // Simulate network delay
            });
        }

        /**
         * Handles form submission for signup.
         */
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                password: document.getElementById('password').value,
                confirmPassword: document.getElementById('confirmPassword').value,
            };

            signupError.classList.add('hidden');

            try {
                // Mock API call
                const result = await mockApiCall(data);

                if (result.success) {
                    console.log(result.message);
                    showPage('page-email-verification');
                } else {
                    signupError.textContent = result.message;
                    signupError.classList.remove('hidden');
                }
            } catch (error) {
                console.error("Signup failed:", error);
                signupError.textContent = "An unexpected error occurred. Please try again.";
                signupError.classList.remove('hidden');
            }
        });


        /**
         * Toggles the visibility of the full-screen receipt modal.
         * @param {boolean} show - True to show, false to hide.
         */
        window.toggleReceiptModal = (show) => {
            if (show) {
                // Hide main app content and show modal
                document.getElementById('app-container').classList.add('hidden');
                receiptModal.classList.remove('hidden');
                setTimeout(() => {
                    receiptModal.classList.remove('opacity-0');
                    receiptModal.classList.add('opacity-100');
                }, 10);
            } else {
                 // Hide modal and show main app content (back to coupon page)
                receiptModal.classList.add('opacity-0');
                receiptModal.classList.remove('opacity-100');
                setTimeout(() => {
                    receiptModal.classList.add('hidden');
                    document.getElementById('app-container').classList.remove('hidden');
                    showPage('page-coupon-entry');
                }, 300);
            }
        }

        /**
         * Copies text to the clipboard and provides simple feedback.
         * @param {string} text - The text content to copy.
         */
        window.copyToClipboard = (text) => {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);

            // Simple visual feedback
            const originalText = "Copy";
            const button = event.currentTarget;
            if (button.textContent.includes(originalText)) {
                button.innerHTML = '<span class="text-scale-green font-semibold">Copied!</span>';
                setTimeout(() => {
                    button.innerHTML = `<svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 5H6a2 2 0 00-2 2v10a2 2 0 002 2h2m0-10h8a2 2 0 012 2v2M8 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2h-2"></path></svg>Copy`;
                }, 1500);
            }
        }

        /**
         * Redirects to the support WhatsApp link.
         */
        window.contactSupport = () => {
             window.open('https://wa.link/m2g76j', '_blank');
        }

        // Initialize the first page view on load
        window.onload = () => {
            showPage('page-signup');
        }

    </script>
</body>
</html>
